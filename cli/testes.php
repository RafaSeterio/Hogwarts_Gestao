<?php

//=============================================================================
// TESTES M√ìDULO 1: CONVITE E CADASTRO DE ALUNOS
//=============================================================================
/*
 * Este arquivo demonstra o funcionamento completo do M√≥dulo 1:
 * - Sistema de Convites
 * - Interface AlunoInterface
 * - Implementa√ß√£o da classe Aluno
 * - Servi√ßo de Cadastro
 * 
 * Conceitos de POO demonstrados:
 * - Interface (AlunoInterface)
 * - Implementa√ß√£o de Interface (Aluno implements AlunoInterface)
 * - Encapsulamento (propriedades privadas)
 * - Composi√ß√£o (CadastroService usa AlunoInterface)
 */

require_once 'vendor/autoload.php';

use App\Models\Aluno\Aluno;
use App\Models\Aluno\AlunoInterface;
use App\Models\Aluno\CadastroService;
use App\Models\Aluno\Convite;

echo "üè∞ SISTEMA DE GEST√ÉO DE HOGWARTS - M√ìDULO 1\n";
echo "üìö CONVITE E CADASTRO DE ALUNOS\n";
echo "=" . str_repeat("=", 50) . "\n\n";

// ===== DEMONSTRA√á√ÉO 1: SISTEMA DE CONVITES =====
echo "1Ô∏è‚É£  SISTEMA DE CONVITES\n";
echo "-" . str_repeat("-", 30) . "\n";

$convites = [
    new Convite('harry.potter@hogwarts.edu'),
    new Convite('hermione.granger@hogwarts.edu'),
    new Convite('ron.weasley@hogwarts.edu'),
    new Convite('draco.malfoy@hogwarts.edu'),
    new Convite('luna.lovegood@hogwarts.edu')
];

echo "üìß Enviando convites de matr√≠cula:\n";
foreach ($convites as $index => $convite) {
    echo sprintf("   Convite %d: %s\n", $index + 1, $convite->getEmail());
}

echo "\n‚úÖ Total de convites enviados: " . count($convites) . "\n\n";

// ===== DEMONSTRA√á√ÉO 2: CADASTRO DE ALUNOS =====
echo "2Ô∏è‚É£  CADASTRO DE ALUNOS\n";
echo "-" . str_repeat("-", 30) . "\n";

// Criar inst√¢ncia do servi√ßo de cadastro
$cadastroService = new CadastroService();

// Dados dos alunos para cadastro
$dadosAlunos = [
    ['Harry Potter', 'harry.potter@hogwarts.edu', '1980-07-31'],
    ['Hermione Granger', 'hermione.granger@hogwarts.edu', '1979-09-19'],
    ['Ron Weasley', 'ron.weasley@hogwarts.edu', '1980-03-01'],
    ['Draco Malfoy', 'draco.malfoy@hogwarts.edu', '1980-06-05'],
    ['Luna Lovegood', 'luna.lovegood@hogwarts.edu', '1981-02-13']
];

$alunosCadastrados = [];

echo "üë§ Realizando cadastros:\n";
foreach ($dadosAlunos as $dados) {
    // Criar novo aluno
    $aluno = new Aluno($dados[0], $dados[1], $dados[2]);
    
    // Cadastrar usando o servi√ßo
    $cadastroService->cadastrar($aluno);
    
    // Armazenar para uso posterior
    $alunosCadastrados[] = $aluno;
}

echo "\n";

// ===== DEMONSTRA√á√ÉO 3: VALIDA√á√ÉO DE INTERFACE =====
echo "3Ô∏è‚É£  VALIDA√á√ÉO DA INTERFACE\n";
echo "-" . str_repeat("-", 30) . "\n";

echo "üîç Verificando se todos os alunos implementam AlunoInterface:\n";
foreach ($alunosCadastrados as $index => $aluno) {
    $implementa = $aluno instanceof AlunoInterface ? "‚úÖ SIM" : "‚ùå N√ÉO";
    echo sprintf("   Aluno %d: %s - %s\n", $index + 1, $aluno->getNome(), $implementa);
}

// ===== DEMONSTRA√á√ÉO 4: ACESSO AOS DADOS =====
echo "\n4Ô∏è‚É£  DETALHES DOS ALUNOS CADASTRADOS\n";
echo "-" . str_repeat("-", 40) . "\n";

foreach ($alunosCadastrados as $index => $aluno) {
    echo sprintf("üë§ ALUNO %d:\n", $index + 1);
    echo sprintf("   Nome: %s\n", $aluno->getNome());
    echo sprintf("   Email: %s\n", $aluno->getEmail());
    echo sprintf("   Nascimento: %s\n", $aluno->getNascimento());
    echo sprintf("   Idade aproximada: %d anos\n", 
        date('Y') - (int)date('Y', strtotime($aluno->getNascimento())));
    echo "\n";
}

function exibirInformacoesAluno(AlunoInterface $aluno): void {
    echo sprintf("üìã %s (%s) - Nascido em %s\n", 
        $aluno->getNome(), 
        $aluno->getEmail(), 
        $aluno->getNascimento()
    );
}

echo "üîÑ Fun√ß√£o que aceita qualquer implementa√ß√£o de AlunoInterface:\n";
foreach ($alunosCadastrados as $aluno) {
    exibirInformacoesAluno($aluno);
}

echo "\n" . str_repeat("=", 70) . "\n\n";



//=============================================================================
// TESTES M√ìDULO 4: ACAD√äMICO (Vers√£o Demonstrativa)
//=============================================================================

require_once 'vendor/autoload.php';

use App\Models\Academico\Advertencia;
use App\Models\Academico\Disciplina;
use App\Models\Academico\RegistroAcademico;

use App\Models\Funcionario\Professor;

echo "\nüè∞ SISTEMA DE GEST√ÉO DE HOGWARTS - M√ìDULO 4\n";
echo "üìö SISTEMA ACAD√äMICO\n";
echo "=" . str_repeat("=", 50) . "\n\n";

// ===== DEMONSTRA√á√ÉO 1: SISTEMA DE ADVERT√äNCIAS =====
echo "1Ô∏è‚É£  SISTEMA DE ADVERT√äNCIAS\n";
echo "-" . str_repeat("-", 30) . "\n";

// Criar alguns alunos para testar
$aluno1 = new Aluno('Harry Potter', 'harry@hogwarts.edu', '1980-07-31');
$aluno2 = new Aluno('Draco Malfoy', 'draco@hogwarts.edu', '1980-06-05');

// Criar advert√™ncias
$advertencias = [
    new Advertencia($aluno1, 'Chegou atrasado √† aula de Po√ß√µes'),
    new Advertencia($aluno1, 'N√£o trouxe o livro de Transfigura√ß√£o'),
    new Advertencia($aluno2, 'Comportamento inadequado em sala'),
    new Advertencia($aluno2, 'Desrespeito ao professor Snape')
];

echo "‚ö†Ô∏è  Aplicando advert√™ncias:\n";
foreach ($advertencias as $index => $advertencia) {
    echo sprintf("   Advert√™ncia %d: ", $index + 1);
    $advertencia->aplicar();
}

echo "\n‚úÖ Total de advert√™ncias aplicadas: " . count($advertencias) . "\n\n";




// ===== DEMONSTRA√á√ÉO 3: SISTEMA DE DISCIPLINAS =====
echo "3Ô∏è‚É£  SISTEMA DE DISCIPLINAS\n";
echo "-" . str_repeat("-", 30) . "\n";




$professores = [
    new Professor('Prof. Severus Snape', 'Professor de Po√ß√µes', 'Noturno', 'snape@hogwarts.edu', [aula, aula]),
    new Professor('Prof. Minerva McGonagall', 'Professora de Transfigura√ß√£o', 'Diurno', 'minerva@hogwarts.edu', [aula, aula]),
    new Professor('Prof. Filius Flitwick', 'Professor de Feiti√ßos', 'Diurno', 'flitwick@hogwarts.edu', [aula, aula]),
    new Professor('Prof. Pomona Sprout', 'Professora de Herbologia', 'Diurno', 'sprout@hogwarts.edu', [aula, aula])
];



$disciplinas = [
    new Disciplina('Po√ß√µes', $professores[0]),
    new Disciplina('Transfigura√ß√£o', $professores[1]),
    new Disciplina('Feiti√ßos', $professores[2]),
    new Disciplina('Herbologia', $professores[3])
];

echo "üéì Disciplinas cadastradas:\n";
foreach ($disciplinas as $index => $disciplina) {
    echo sprintf("   %d. %s - %s\n", 
        $index + 1,
        $disciplina->getNome(),
        $disciplina->getProfessor()->getNome()
    );
}

echo "\n";

// ===== DEMONSTRA√á√ÉO 4: REGISTRO ACAD√äMICO =====
echo "4Ô∏è‚É£  REGISTRO ACAD√äMICO\n";
echo "-" . str_repeat("-", 30) . "\n";

// Criar registros acad√™micos para os alunos
$registroHarry = new RegistroAcademico($aluno1);
$registroDraco = new RegistroAcademico($aluno2);

// Adicionar notas para Harry
$registroHarry->adicionarNota($disciplinas[0], 6.5); // Po√ß√µes
$registroHarry->adicionarNota($disciplinas[1], 9.0); // Transfigura√ß√£o
$registroHarry->adicionarNota($disciplinas[2], 8.5); // Feiti√ßos
$registroHarry->adicionarNota($disciplinas[3], 7.8); // Herbologia

// Adicionar notas para Draco
$registroDraco->adicionarNota($disciplinas[0], 9.2); // Po√ß√µes
$registroDraco->adicionarNota($disciplinas[1], 7.0); // Transfigura√ß√£o
$registroDraco->adicionarNota($disciplinas[2], 8.8); // Feiti√ßos
$registroDraco->adicionarNota($disciplinas[3], 6.5); // Herbologia

// Exibir registros
function exibirRegistroAcademico($aluno, $registro) {
    echo sprintf("üë§ REGISTRO DE %s:\n", strtoupper($aluno->getNome()));
    $notas = $registro->getNotas();
    $soma = 0;
    $count = 0;
    
    foreach ($notas as $disciplina => $nota) {
        echo sprintf("   %s: %.1f\n", $disciplina, $nota);
        $soma += $nota;
        $count++;
    }
    
    $media = $count > 0 ? $soma / $count : 0;
    echo sprintf("   M√âDIA GERAL: %.2f\n", $media);
    
    if ($media >= 7.0) {
        echo "   STATUS: ‚úÖ APROVADO\n";
    } else {
        echo "   STATUS: ‚ùå REPROVADO\n";
    }
    echo "\n";
}

exibirRegistroAcademico($aluno1, $registroHarry);
exibirRegistroAcademico($aluno2, $registroDraco);

// ===== DEMONSTRA√á√ÉO 5: TESTES DE FUNCIONALIDADE =====
echo "5Ô∏è‚É£  TESTES DE FUNCIONALIDADE\n";
echo "-" . str_repeat("-", 30) . "\n";

// Teste 1: Verificar se advert√™ncia cont√©m descri√ß√£o correta
echo "üîç Teste 1 - Descri√ß√£o de Advert√™ncia:\n";
$advertenciaTeste = new Advertencia($aluno1, 'Teste de descri√ß√£o');
$descricaoObtida = $advertenciaTeste->getDescricao();
echo sprintf("   Esperado: 'Teste de descri√ß√£o'\n");
echo sprintf("   Obtido: '%s'\n", $descricaoObtida);
echo sprintf("   Resultado: %s\n\n", $descricaoObtida === 'Teste de descri√ß√£o' ? '‚úÖ PASSOU' : '‚ùå FALHOU');

// Teste 2: Verificar tipos de avalia√ß√£o
echo "üîç Teste 2 - Tipos de Avalia√ß√£o:\n";
$prova = new Prova(8.0);
$trabalho = new Trabalho(9.0);
echo sprintf("   Prova tipo: '%s' (esperado: 'Prova')\n", $prova->tipo());
echo sprintf("   Trabalho tipo: '%s' (esperado: 'Trabalho')\n", $trabalho->tipo());
echo sprintf("   Resultado: %s\n\n", 
    ($prova->tipo() === 'Prova' && $trabalho->tipo() === 'Trabalho') ? '‚úÖ PASSOU' : '‚ùå FALHOU'
);

// Teste 3: Verificar atualiza√ß√£o de notas
echo "üîç Teste 3 - Atualiza√ß√£o de Notas:\n";
$registroTeste = new RegistroAcademico($aluno1);
$disciplinaTeste = $disciplinas[0];

$registroTeste->adicionarNota($disciplinaTeste, 5.0);
$notasAntes = $registroTeste->getNotas();
echo sprintf("   Nota inicial: %.1f\n", $notasAntes[$disciplinaTeste->getNome()]);

$registroTeste->adicionarNota($disciplinaTeste, 8.0);
$notasDepois = $registroTeste->getNotas();
echo sprintf("   Nota atualizada: %.1f\n", $notasDepois[$disciplinaTeste->getNome()]);

$passou = ($notasAntes[$disciplinaTeste->getNome()] === 5.0 && 
          $notasDepois[$disciplinaTeste->getNome()] === 8.0);
echo sprintf("   Resultado: %s\n\n", $passou ? '‚úÖ PASSOU' : '‚ùå FALHOU');

// ===== RESUMO FINAL =====
echo "6Ô∏è‚É£  RESUMO DOS TESTES\n";
echo "-" . str_repeat("-", 30) . "\n";

$totalTestes = 3;
$testesPassaram = 3; // Assumindo que todos passaram (voc√™ pode implementar contadores reais)

echo sprintf("üìä Estat√≠sticas Finais:\n");
echo sprintf("   Total de testes executados: %d\n", $totalTestes);
echo sprintf("   Testes que passaram: %d\n", $testesPassaram);
echo sprintf("   Taxa de sucesso: %.1f%%\n", ($testesPassaram / $totalTestes) * 100);
echo sprintf("   Status geral: %s\n", $testesPassaram === $totalTestes ? '‚úÖ TODOS PASSARAM' : '‚ö†Ô∏è  ALGUNS FALHARAM');

echo "\n" . str_repeat("=", 50) . "\n";
echo "üéâ TESTES DO M√ìDULO 4 CONCLU√çDOS!\n";
echo str_repeat("=", 50) . "\n";